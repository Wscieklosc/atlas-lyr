<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Status wiedzy Lyr</title>
<style>
  body{background:#0b0f14;color:#e9eef7;font-family:system-ui,Segoe UI,Roboto,sans-serif;margin:0}
  .wrap{max-width:1100px;margin:24px auto;padding:0 14px}
  .card{background:#121821;border:1px solid #1b2330;border-radius:16px;padding:16px;margin:12px 0}
  h1{font-size:22px;margin:10px 0}
  h2{font-size:16px;margin:0 0 8px 0;color:#b9c7dc}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .pill{display:inline-block;background:#172131;border:1px solid #26344a;border-radius:999px;padding:4px 10px;margin-right:6px}
  code,pre{background:#0f141c;border:1px solid #1b2330;border-radius:8px;padding:10px;display:block;overflow:auto}
  small{opacity:.75}
  button{background:#1d2a3d;border:1px solid #29405b;color:#e9eef7;border-radius:10px;padding:8px 12px;cursor:pointer}
  button:hover{filter:brightness(1.1)}
</style>
</head>
<body>
<div class="wrap">
  <h1>ğŸ“– Status wiedzy Lyr</h1>

  <div class="card" id="top">
    <h2>Model i serwer</h2>
    <div id="model"></div>
    <div id="srv"></div>
  </div>

  <div class="card">
    <h2>PamiÄ™Ä‡ rozmÃ³w</h2>
    <div id="mem"></div>
    <pre id="memLast"></pre>
  </div>

  <div class="card">
    <h2>KsiÄ™gi (docx_txt)</h2>
    <div id="docs"></div>
    <pre id="files"></pre>
  </div>

  <div class="card">
    <h2>System prompt</h2>
    <div id="sp"></div>
  </div>

  <div class="card">
    <h2>NarzÄ™dzia</h2>
    <div id="tools"></div>
    <div style="margin-top:10px" class="row">
      <button id="reloadBtn">ğŸ”„ Przebuduj esencjÄ™ i indeks (/reload)</button>
      <button id="openJson">ğŸ‘ PodglÄ…d JSON</button>
    </div>
    <small>Po zmianach w KsiÄ™gach kliknij â€Przebudujâ€¦â€.</small>
  </div>
</div>

<script>
async function load() {
  const r = await fetch("/status");
  const j = await r.json();

  // Model i serwer
  document.getElementById("model").innerHTML =
    `<span class="pill">Model: ${j.model}</span>`;
  document.getElementById("srv").innerHTML =
    `<span class="pill">PID: ${j.server.pid}</span>` +
    `<span class="pill">Uptime: ${j.server.uptime_sec}s</span>`;

  // PamiÄ™Ä‡ rozmÃ³w
  document.getElementById("mem").innerHTML =
    `<span class="pill">Wpisy: ${j.memory.items}</span>`;
  document.getElementById("memLast").textContent =
    `Ostatni uÅ¼ytkownik: ${j.memory.last_user_sample || "-"}\n` +
    `Ostatnia Lyr: ${j.memory.last_assistant_sample || "-"}`;

  // KsiÄ™gi
  document.getElementById("docs").innerHTML =
    `<span class="pill">PlikÃ³w: ${j.docs.count}</span>` +
    `<span class="pill">ZnakÃ³w (Å‚Ä…cznie): ${j.docs.chars_total}</span>`;
  document.getElementById("files").textContent =
    (j.docs.files_preview || []).join(" â€¢ ");

  // System prompt
  document.getElementById("sp").innerHTML =
    `<span class="pill">Bazowy: ${j.system_prompt.base_chars}</span>` +
    `<span class="pill">Z KsiÄ™gami: ${j.system_prompt.with_docs_chars}</span>`;

  // NarzÄ™dzia
  document.getElementById("tools").innerHTML =
    `<span class="pill">convert_docs.sh: ${j.tools.convert_docs_sh ? "OK" : "brak"}</span>`;
}
load().catch(console.error);

document.getElementById("reloadBtn").onclick = async () => {
  try {
    await fetch("/reload", { method: "POST" });
    setTimeout(load, 1200);
  } catch(e){ alert("BÅ‚Ä…d /reload"); }
};
document.getElementById("openJson").onclick = () => { window.open("/status","_blank"); };
</script>
</body>
</html>
